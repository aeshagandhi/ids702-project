---
title: "research_question_1"
format: pdf
editor: visual
---

```{r load-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(readxl)
library(dplyr)
library(ggplot2)
```

```{r data-1, warning=FALSE}
#Read the dataset, select the columns to be used and drop the missing data
energy_rq1 <- read_excel("owid-energy-data.xlsx") %>%
  select(country, year, gdp, population, carbon_intensity_elec,fossil_share_elec,electricity_generation) %>%
  mutate(gdp_per_capita = gdp / population) %>%
  filter(!is.na(carbon_intensity_elec),
         !is.na(gdp_per_capita))

glimpse(energy_rq1)
```

**Research question 1:**

**Does a country’s GDP per capita significantly affect the carbon intensity of its electricity generation, and does this relationship differ between high-income and low-income countries?**

-   Outcome variable (include the name/description and type of variable):
    -   `carbon_intensity_elec` **(continuous)**：measures the amount of carbon dioxide emitted per unit of electricity generated (grams of CO₂ per kilowatt-hour). It captures how carbon-efficient a country’s electricity production is — lower values indicate cleaner, more renewable-based power systems.

```{r}
head(energy_rq1, 5)
```

```         
```

Because the OWID Energy dataset does not include income classifications, we merged it with a separate World Bank income-group dataset (from same source) that provides each country’s income level by year. This merge, done using country name and year, allows us to include income group as a key predictor and test whether the GDP–carbon-intensity relationship differs across income categories.

```{r}
income <- read.csv(
  "https://raw.githubusercontent.com/owid/owid-datasets/master/datasets/Country%20Income%20Classification%20-%20World%20Bank%20(2017)/Country%20Income%20Classification%20-%20World%20Bank%20(2017).csv"
)
head(income, 5)
```

```{r}
income <- income %>%
  rename(
    country = Entity,
    income_code = Income.classification..World.Bank.2017.,
    year = Year
  )

income <- income %>%
  mutate(income_group = case_when(
    income_code == 4 ~ "High income",
    income_code == 3 ~ "Upper middle income",
    income_code == 2 ~ "Lower middle income",
    income_code == 1 ~ "Low income"
  ))


```

```{r}
energy_income <- energy_rq1 %>%
  left_join(income, by = c("country", "year"))

head(energy_income)
```

## Clean Data

```{r}
library(dplyr)

cleaned <- energy_income %>%
  filter(
    !is.na(carbon_intensity_elec),
    !is.na(gdp_per_capita),
    !is.na(income_group)
  ) %>%
  mutate(
    log_gdp = log(gdp_per_capita),
    income_group = factor(income_group)   # ensure categorical
  )

cleaned$income_group <- factor(cleaned$income_group,
                               levels = c("Low income",
                                          "Lower middle income",
                                          "Upper middle income",
                                          "High income"))


head(cleaned)
```

```{}
```

## EDA

```{r}
library(ggplot2)

ggplot(cleaned, aes(x = gdp_per_capita)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "white") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Distribution of GDP per Capita (Raw)",
    x = "GDP per capita",
    y = "Count"
  )


ggplot(cleaned, aes(x = log_gdp)) +
  geom_histogram(bins = 50, fill = "darkgreen", color = "white") +
  labs(
    title = "Distribution of Log(GDP per Capita)",
    x = "log(GDP per capita)",
    y = "Count"
  )

```

```{r}
ggplot(cleaned, aes(x = gdp_per_capita, y = carbon_intensity_elec)) +
  geom_point(alpha = 0.3) +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Carbon Intensity vs GDP per Capita (Raw)",
    x = "GDP per capita",
    y = "Carbon intensity of electricity (gCO₂/kWh)"
  )

ggplot(cleaned, aes(x = log_gdp, y = carbon_intensity_elec)) +
  geom_point(alpha = 0.3) +
  labs(
    title = "Carbon Intensity vs Log(GDP per Capita)",
    x = "log(GDP per capita)",
    y = "Carbon intensity of electricity (gCO₂/kWh)"
  )

```

In the histogram, GDP per capita is extremely right-skewed, with most countries clustered at low values and a long tail of very high-income countries. Log-transforming GDP produces a more symmetric distribution appropriate for linear modeling. In the scatter plot, the relationship between GDP and carbon intensity is curved and compresses most observations into a narrow region at low GDP levels. Using log(GDP) spreads the data more evenly and produces a clearer, more linear relationship suitable for regression.

```         
```

Does GDP per capita affect carbon intensity, and does this relationship differ by income group?

This model requires an interaction term.

$$
CI_i = \beta_0 + + \beta_1 \, GDPpc_i+ \beta_2 \, IncomeGroup_i+ \beta_3 \, GDPpc_i \times IncomeGroup_i+ \varepsilon_i.
$$

```{r}
# basic raw model
raw_model <- lm(
  carbon_intensity_elec ~ gdp_per_capita * income_group,
  data = cleaned
)

summary(raw_model)
confint(raw_model)
plot(raw_model)
```

This raw model treats GDP per capita as a linear, untransformed, and evenly spaced continuous variable. As hinted in the EDA, this may be problematic due to the following observations:

-   GDP per capita is very right skewed. Most countries have a very low GDP and a few have extremely high GDP.

-   The scatterplot with raw GDP from earlier shows a curved, nonlinear pattern, while the model tries to force that curvature into a straight line.

How this affects the results?

The raw model forces linearity such that:

-   All income groups have a positive main effect of GDP increasing carbon intensity.

-   GDP is skewed so that small numeric changes at the low end represent tiny economic differences while numeric changes at the high end represent huge jumps in wealth. Thus, the slopes could be distorted and not represent true relationships.

Diagnostics

-   Heteroskedasticity observed by fan shape in Residuals vs Fitted plot

-   Curvature in Residuals vs Fitted suggesting linearity violated.

```{r}
model <- lm(
  carbon_intensity_elec ~ log_gdp * income_group,
  data = cleaned
)

summary(model)
confint(model)

```

```{r}
coefs <- coef(model)

#  Low income  (reference)
slope_low <- coefs["log_gdp"]

# Lower middle income
slope_lower_middle <- coefs["log_gdp"] +
  coefs["log_gdp:income_groupLower middle income"]

# Upper middle income
slope_upper_middle <- coefs["log_gdp"] +
  coefs["log_gdp:income_groupUpper middle income"]

# High income
slope_high <- coefs["log_gdp"] +
  coefs["log_gdp:income_groupHigh income"]

c(slope_low, slope_lower_middle, slope_upper_middle, slope_high)



```

```{r}
library(ggplot2)

ggplot(cleaned, aes(x = log_gdp, y = carbon_intensity_elec, color = income_group)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Carbon Intensity of Electricity vs GDP per Capita",
    subtitle = "Interaction between GDP per capita and income group",
    x = "Log GDP per capita",
    y = "Carbon intensity of electricity (gCO₂/kWh)"
  )
```

```{r}
plot(model)
```

```{r}
confint(model)
```

The model we fit is:

$$
CI_i = \beta_0 + + \beta_1 \, \log(GDPpc_i)+ \beta_2 \, IncomeGroup_i+ \beta_3 \, [\log(GDPpc_i) \times IncomeGroup_i]+ \varepsilon_i.
$$

The use of an **interaction term** allows the slope of GDP per capita to differ across income groups, which is essential for answering whether economic development operates differently in richer vs. poorer countries.

Model Interpretation

When holding all other variables constant:

-   For **low-income countries**, a **one-unit increase in log(GDP per capita)** is associated with an **increase of 104.75 gCO₂/kWh** in carbon intensity, holding income group constant. This means that in low-income countries, economic growth corresponds to **more carbon-intensive electricity**.

-   Holding log(GDP per capita) constant, **lower-middle-income countries** have carbon intensity values that are **262.54 gCO₂/kWh higher** on average than **low-income countries**, but the difference is **not statistically significant**.

-   Holding log(GDP per capita) constant, **upper-middle-income countries** have carbon intensity values that are **178.96 gCO₂/kWh higher** on average than **low-income countries**, but this difference is **not statistically significant**.

-   Holding log(GDP per capita) constant, **high-income countries** have carbon intensity levels that are **1,722.88 gCO₂/kWh higher** than **low-income countries**, and this difference **is statistically significant**. This reflects major structural differences in electricity systems across income levels.

-   Compared to low-income countries, the slope relating log(GDP) to carbon intensity in lower-middle-income countries is **33.00 gCO₂/kWh smaller** for each unit increase in log(GDP), but the difference is **not statistically significant**.

-   Compared to low-income countries, the slope is **27.91 gCO₂/kWh smaller** for every one-unit increase in log(GDP). This difference is **not statistically significant**.

-   Compared to low-income countries, the slope is **185.81 gCO₂/kWh more negative** for each unit increase in log(GDP). This is **highly statistically significant**, and it completely reverses the sign of the GDP effect in high-income countries.

    -   In low-income countries, GDP growth **increases** carbon intensity.

    -   In high-income countries, GDP growth **decreases** carbon intensity.

    This suggests that wealthy countries decarbonize as they grow, whereas poorer countries carbonize as they grow.

The reversal of the GDP effect between low and high-income countries indicates fundamentally different development pathways. Low-income countries appear to rely more heavily on coal, diesel, and other fossil fuels when expanding electricity access, causing carbon intensity to rise as GDP increases. High-income countries, however, may already have built or transitioned toward cleaner electricity systems, so additional economic growth is associated with investments in renewable energy, efficiency, and environmental regulations. As a result, high-income countries show declining carbon intensity as GDP increases, which suggests decarbonization, while low-income countries show increasing carbon intensity, reflecting carbonization during early development.

Model Assessment/Diagnostics

-   Linearity: The Residuals vs Fitted plot does not show any major curvature so the linearity assumption is reasonable.

-   Normality: The Q-Q plot shows slight deviation at the tail ends but is overall reasonable, so the normality of residuals assumption is not violated.

-   Homoskedasticity: The Residuals vs Fitted plot shows moderate heteroskedasticity indicated via a fan shape in the residuals.

-   Influential Observations: The residuals leverage plot does not show any observations with concerningly high Cook's Distance.
